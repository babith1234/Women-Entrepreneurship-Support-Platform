import { pool } from "../config/db.js";
import { mentorSchema } from "../lib/schemas.js";

/**
 * @route GET /mentors
 * @description Gets all the mentors
 * @access public
 */
export async function getAllMentors(req, res) {
  try {
    const query = "SELECT * FROM MENTOR";
    const mentors = await pool.query(query);
    return res.status(200).json({ mentors: mentors.rows });
  } catch (error) {
    return res.status(500).json({ error: error.message });
  }
}

/**
 * @route POST /mentor
 * @description add a new mentor
 * @requires id (autogenerated), authority_id (fetched), type, name, description, date, city, state, country, people affected, severity
 * @access private (authority)
 */
export async function reportDisaster(req, res) {
  const mentor = { ...req.body };

  const parsedMentor = mentorSchema.safeParse(mentor);
  if (!parsedMentor.success) {
    return res.status(400).json({ error: parsedMentor.error });
  }
  const mentorData = parsedMentor.data;

  const query = `INSERT INTO MENTOR (mentor_id, mentor_name, domain) VALUES ($1, $2, $3) RETURNING id`;
  const mentorResult = await pool.query(query, [
    mentorData.mentor_id,
    mentorData.mentor_name.toLowerCase(),
    mentorData.domain.toLowerCase(),
  ]);
  return res.status(201).json({
    success: true,
    message: "Mentor registered successfully",
    mentor_id: mentorResult.rows[0].id,
  });
}
